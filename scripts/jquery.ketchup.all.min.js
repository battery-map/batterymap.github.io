!function(b){b.ketchup={defaults:{attribute:"data-validate",validateIndicator:"validate",eventIndicator:"on",validateEvents:"blur",validateElements:["input","textarea","select"],createErrorContainer:null,showErrorContainer:null,hideErrorContainer:null,addErrorMessages:null},dataNames:{validationString:"ketchup-validation-string",validations:"ketchup-validations",events:"ketchup-events",elements:"ketchup-validation-elements",container:"ketchup-container"},validations:{},helpers:{},validation:function(a,b,c,d){var e;return"function"==typeof b?b=b:(e=b,b=c),this.validations[a]={message:e,func:b,init:d||function(){}},this},message:function(a,b){return this.addMessage(a,b),this},messages:function(a){for(name in a)this.addMessage(name,a[name]);return this},addMessage:function(a,b){this.validations[a]&&(this.validations[a].message=b)},helper:function(a,b){return this.helpers[a]=b,this},init:function(a,c,d){this.options=c;var e=this;c=this.initFunctions().initFields(a,d),c.each(function(){var c=b(this);e.bindValidationEvent(a,c).callInitFunctions(a,c)}),a.data(this.dataNames.elements,c),this.bindFormSubmit(a)},initFunctions:function(){var a=this.options,b=["createErrorContainer","showErrorContainer","hideErrorContainer","addErrorMessages"];for(f=0;f<b.length;f++){var c=b[f];a[c]||(a[c]=this[c])}return this},initFields:function(a,c){var d=this,e=this.dataNames,f=b(c?this.fieldsFromObject(a,c):this.fieldsFromForm(a));return f.each(function(){var a=b(this),c=d.extractValidations(a.data(e.validationString),d.options.validateIndicator);a.data(e.validations,c)}),f},callInitFunctions:function(a,b){var c=b.data(this.dataNames.validations);for(i=0;i<c.length;i++)c[i].init.apply(this.helpers,[a,b])},fieldsFromForm:function(a){var c=this,d=this.options,e=this.dataNames,f=d.validateElements,g=[];for(f="string"==typeof f?[f]:f,i=0;i<f.length;i++){var h=a.find(f[i]+"["+d.attribute+"*="+d.validateIndicator+"]");h.each(function(){var a=b(this),f=a.attr(d.attribute),g=c.extractEvents(f,d.eventIndicator);a.data(e.validationString,f).data(e.events,g?g:d.validateEvents)}),g.push(h.get())}return this.normalizeArray(g)},fieldsFromObject:function(a,b){var c=this.options,d=this.dataNames,e=[];for(s in b){var f,g;"string"==typeof b[s]?(f=b[s],g=c.validateEvents):(f=b[s][0],g=b[s][1]);var h=a.find(s);f=this.mergeValidationString(h,f),g=this.mergeEventsString(h,g),h.data(d.validationString,c.validateIndicator+"("+f+")").data(d.events,g),e.push(h.get())}return this.normalizeArray(e)},mergeEventsString:function(a,c){var d=a.data(this.dataNames.events),e="";if(d)for(d=d.split(" "),i=0;i<d.length;i++)-1==c.indexOf(d[i])&&(e+=" "+d[i]);return b.trim(c+e)},mergeValidationString:function(a,b){var c=this.options,d=a.data(this.dataNames.validationString),e=function(a){var b=a.name;return a.arguments.length&&(b=b+"("+a.arguments.join(",")+")"),b},f=function(a,b){for(i=0;i<a.length;i++)if(a[i].name==b.name)return!0};if(d){var g=this.extractValidations(c.validateIndicator+"("+b+")",c.validateIndicator);for(c=this.extractValidations(d,c.validateIndicator),b="",o=0;o<c.length;o++)b+=e(c[o])+",";for(n=0;n<g.length;n++)f(c,g[n])||(b+=e(g[n])+",")}return b},bindFormSubmit:function(a){var b=this;a.submit(function(){return b.allFieldsValid(a,!0)})},allFieldsValid:function(a,c){var d=this,e=!0;return a.data(this.dataNames.elements).each(function(){var f=b(this);1!=d.validateElement(f,a)&&(1==c&&d.triggerValidationEvents(f),e=!1)}),a.trigger("formIs"+(e?"Valid":"Invalid"),[a]),e},bindValidationEvent:function(a,b){var c=this,d=this.options,e=this.dataNames,f=b.data(e.events).split(" ");for(i=0;i<f.length;i++)b.bind("ketchup."+f[i],function(){var f=c.validateElement(b,a),g=b.data(e.container);1!=f?(g||(g=d.createErrorContainer(a,b),b.data(e.container,g)),d.addErrorMessages(a,b,g,f),d.showErrorContainer(a,b,g)):g&&d.hideErrorContainer(a,b,g)}),this.bindValidationEventBridge(b,f[i]);return this},bindValidationEventBridge:function(a,b){a.bind(b,function(){a.trigger("ketchup."+b)})},validateElement:function(a,b){var c=[],d=a.data(this.dataNames.validations),e=[b,a,a.val()];for(i=0;i<d.length;i++)d[i].func.apply(this.helpers,e.concat(d[i].arguments))||c.push(d[i].message);return b.trigger("fieldIs"+(c.length?"Invalid":"Valid"),[b,a]),c.length?c:!0},elementIsValid:function(a){var b=this.dataNames;return a.data(b.validations)?(b=a.parentsUntil("form").last().parent(),1==this.validateElement(a,b)?!0:!1):a.data(b.elements)?this.allFieldsValid(a):null},triggerValidationEvents:function(a){for(var b=a.data(this.dataNames.events).split(" "),c=0;c<b.length;c++)a.trigger("ketchup."+b[c])},extractValidations:function(c,d){for(var e=c.substr(c.indexOf(d)+d.length+1),f="",g=[],h=0,i=[],j=0;j<e.length;j++)switch(e.charAt(j)){case"(":f+="(",h++;break;case")":h?(f+=")",h--):g.push(b.trim(f));break;case",":h?f+=",":(g.push(b.trim(f)),f="");break;default:f+=e.charAt(j)}for(v=0;v<g.length;v++)if(h=g[v].indexOf("("),e=g[v],f=[],-1!=h&&(e=b.trim(g[v].substr(0,h)),f=b.map(g[v].substr(e.length).split(","),function(a){return b.trim(a.replace("(","").replace(")",""))})),(h=this.validations[e])&&h.message){for(j=h.message,a=1;a<=f.length;a++)j=j.replace("{arg"+a+"}",f[a-1]);i.push({name:e,arguments:f,func:h.func,message:j,init:h.init})}return i},extractEvents:function(a,b){var c=!1,d=a.indexOf(b+"(");return-1!=d&&(c=a.substr(d+b.length+1).split(")")[0]),c},normalizeArray:function(a){var b=[];for(i=0;i<a.length;i++)for(e=0;e<a[i].length;e++)a[i][e]&&b.push(a[i][e]);return b},createErrorContainer:function(a,c){if("function"==typeof a)return this.defaults.createErrorContainer=a,this;var d=c.offset();return b("<div/>",{html:"<ul></ul><span></span>","class":"ketchup-error",css:{top:d.top,left:d.left+c.outerWidth()-20}}).appendTo("body")},showErrorContainer:function(a,b,c){return"function"==typeof a?(this.defaults.showErrorContainer=a,this):(c.show().animate({top:b.offset().top-c.height(),opacity:1},"fast"),void 0)},hideErrorContainer:function(a,b,c){return"function"==typeof a?(this.defaults.hideErrorContainer=a,this):(c.animate({top:b.offset().top,opacity:0},"fast",function(){c.hide()}),void 0)},addErrorMessages:function(a,c,d,e){if("function"==typeof a)return this.defaults.addErrorMessages=a,this;for(a=d.children("ul"),a.html(""),i=0;i<e.length;i++)b("<li/>",{text:e[i]}).appendTo(a)}},b.fn.ketchup=function(a,c){var d=b(this);if("string"==typeof a)switch(a){case"validate":b.ketchup.triggerValidationEvents(d);break;case"isValid":return b.ketchup.elementIsValid(d)}else this.each(function(){b.ketchup.init(d,b.extend({},b.ketchup.defaults,a),c)});return this}}(jQuery),jQuery.ketchup.validation("required","\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.",function(a,b,c){return a=b.attr("type").toLowerCase(),"checkbox"==a||"radio"==a?1==b.attr("checked"):0!=c.length}).validation("minlength","This field must have a minimal length of {arg1}.",function(a,b,c,d){return c.length>=+d}).validation("maxlength","This field must have a maximal length of {arg1}.",function(a,b,c,d){return c.length<=+d}).validation("rangelength","\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u0434\u043e\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0434\u043b\u0438\u043d\u0443 \u043e\u0442 {arg1} \u0434\u043e {arg2} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432.",function(a,b,c,d,e){return c.length>=d&&c.length<=e}).validation("min","Must be at least {arg1}.",function(a,b,c,d){return this.isNumber(c)&&+c>=+d}).validation("max","Can not be greater than {arg1}.",function(a,b,c,d){return this.isNumber(c)&&+d>=+c}).validation("range","Must be between {arg1} and {arg2}.",function(a,b,c,d,e){return this.isNumber(c)&&+c>=+d&&+e>=+c}).validation("number","Must be a number.",function(a,b,c){return this.isNumber(c)}).validation("digits","Must be digits.",function(a,b,c){return/^\d+$/.test(c)}).validation("email","\u0414\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 E-Mail.",function(a,b,c){return this.isEmail(c)}).validation("url","Must be a valid URL.",function(a,b,c){return this.isUrl(c)}).validation("username","Must be a valid username.",function(a,b,c){return this.isUsername(c)}).validation("match","Must be {arg1}.",function(a,b,c,d){return b.val()==d}).validation("contain","Must contain {arg1}",function(a,b,c,d){return this.contains(c,d)}).validation("date","Must be a valid date.",function(a,b,c){return this.isDate(c)}).validation("minselect","Select at least {arg1} checkboxes.",function(a,b,c,d){return d<=this.inputsWithName(a,b).filter(":checked").length},function(a,b){this.bindBrothers(a,b)}).validation("maxselect","Select not more than {arg1} checkboxes.",function(a,b,c,d){return d>=this.inputsWithName(a,b).filter(":checked").length},function(a,b){this.bindBrothers(a,b)}).validation("rangeselect","Select between {arg1} and {arg2} checkboxes.",function(a,b,c,d,e){return a=this.inputsWithName(a,b).filter(":checked").length,a>=d&&e>=a},function(a,b){this.bindBrothers(a,b)}),jQuery.ketchup.helper("isNumber",function(a){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)}).helper("contains",function(a,b){return-1!=a.indexOf(b)}).helper("isEmail",function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)}).helper("isUrl",function(a){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)}).helper("isUsername",function(a){return/^([a-zA-Z])[a-zA-Z_-]*[\w_-]*[\S]$|^([a-zA-Z])[0-9_-]*[\S]$|^[a-zA-Z]*[\S]$/.test(a)}).helper("isDate",function(a){return!/Invalid|NaN/.test(new Date(a))}).helper("inputsWithName",function(a,b){return $('input[name="'+b.attr("name")+'"]',a)}).helper("inputsWithNameNotSelf",function(a,b){return this.inputsWithName(a,b).filter(function(){return $(this).index()!=b.index()})}).helper("getKetchupEvents",function(a){a=a.data("events").ketchup;var b=[];for(i=0;i<a.length;i++)b.push(a[i].namespace);return b.join(" ")}).helper("bindBrothers",function(a,b){this.inputsWithNameNotSelf(a,b).bind(this.getKetchupEvents(b),function(){b.ketchup("validate")})});